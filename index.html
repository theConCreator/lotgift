<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Telegram Slot Machine üé∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Lottie -->
  <script src="https://unpkg.com/lottie-web/build/player/lottie_light.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden; /* üö´ —É–±–∏—Ä–∞–µ–º —Å–∫—Ä–æ–ª–ª */
      background: linear-gradient(to bottom, #2e026d, #000);
    }
    .slot-window {
      width: 100px;
      height: 100px;
      overflow: hidden;
      border-radius: 12px;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .slot-strip {
      transition: transform 2s cubic-bezier(0.25, 1, 0.5, 1);
    }
  </style>
</head>
<body class="text-white flex items-center justify-center h-screen w-screen">
  <div id="root"></div>

  <script type="text/javascript">
    const { useState, useEffect, useRef } = React;

    // üéÅ –ü—Ä–∏–º–µ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤
    const gifts = [
      { name: "Hypno Lollipop", file: "./assets/gifts/Hypno Lollipop.json" },
      { name: "Desk Calendar", file: "./assets/gifts/Desk Calendar.json" },
      { name: "B-Day Candle", file: "./assets/gifts/B-Day Candle.json" },
      { name: "Lol Pop", file: "./assets/gifts/Lol Pop.json" }
    ];

    // üîπ –û–¥–∏–Ω –±–∞—Ä–∞–±–∞–Ω
    function Reel({ spinning, finalGift }) {
      const stripRef = useRef(null);
      const [items, setItems] = useState([]);
      const [offset, setOffset] = useState(0);

      useEffect(() => {
        // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º 20 —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ + —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤ –∫–æ–Ω—Ü–µ
        const newItems = [];
        for (let i = 0; i < 20; i++) {
          newItems.push(gifts[Math.floor(Math.random() * gifts.length)]);
        }
        if (finalGift) newItems.push(finalGift);
        setItems(newItems);

        // —Å–±—Ä–æ—Å –Ω–∞ –Ω–∞—á–∞–ª–æ
        setOffset(0);

        if (spinning && finalGift) {
          // –∂–¥—ë–º –æ–¥–∏–Ω —Ç–∏–∫ —á—Ç–æ–±—ã CSS transition –æ—Ç—Ä–∞–±–æ—Ç–∞–ª
          requestAnimationFrame(() => {
            const finalIndex = newItems.length - 1;
            setOffset(-(finalIndex * 100));
          });
        }
      }, [spinning, finalGift]);

      // –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ–±–µ–¥–Ω–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞
      useEffect(() => {
        if (!spinning && finalGift) {
          const node = stripRef.current.querySelector(`#slot-${finalGift.name.replace(/\s/g, '-')}`);
          if (node) {
            node.innerHTML = "";
            lottie.loadAnimation({
              container: node,
              renderer: "svg",
              loop: false,
              autoplay: true,
              path: finalGift.file,
            });
          }
        }
      }, [spinning, finalGift]);

      return (
        React.createElement("div", { className: "slot-window" },
          React.createElement("div", {
            ref: stripRef,
            className: "slot-strip",
            style: { transform: `translateY(${offset}px)` }
          },
            items.map((gift, i) =>
              React.createElement("div", {
                key: i,
                id: `slot-${gift.name.replace(/\s/g, '-')}`,
                className: "flex items-center justify-center w-[100px] h-[100px] text-black"
              }, gift.name)
            )
          )
        )
      );
    }

    // üé∞ –ê–≤—Ç–æ–º–∞—Ç
    function SlotMachine() {
      const [spinning, setSpinning] = useState(false);
      const [final, setFinal] = useState([null, null, null]);
      const machineRef = useRef(null);

      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ–Ω-–∞–≤—Ç–æ–º–∞—Ç
      useEffect(() => {
        if (!machineRef.current) return;
        lottie.loadAnimation({
          container: machineRef.current,
          renderer: "svg",
          loop: true,
          autoplay: true,
          path: "./assets/777.json"
        });
      }, []);

      const spin = () => {
        if (spinning) return;
        const results = [
          gifts[Math.floor(Math.random() * gifts.length)],
          gifts[Math.floor(Math.random() * gifts.length)],
          gifts[Math.floor(Math.random() * gifts.length)]
        ];
        setFinal(results);
        setSpinning(true);

        // –≤—ã–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º —á–µ—Ä–µ–∑ 2—Å
        setTimeout(() => {
          setSpinning(false);
        }, 2000);
      };

      return (
        React.createElement("div", { className: "flex flex-col items-center" },
          React.createElement("div", { className: "relative w-[400px] h-[400px] flex items-center justify-center" },
            // –ë–∞—Ä–∞–±–∞–Ω—ã (—Å–∑–∞–¥–∏)
            React.createElement("div", { className: "absolute flex gap-4 z-0" },
              final.map((gift, i) =>
                React.createElement(Reel, { key: i, spinning, finalGift: gift })
              )
            ),
            // –ê–≤—Ç–æ–º–∞—Ç (–ø–æ–≤–µ—Ä—Ö)
            React.createElement("div", { ref: machineRef, className: "absolute inset-0 z-50" })
          ),
          React.createElement("button", {
            onClick: spin,
            disabled: spinning,
            className: "mt-6 px-6 py-2 bg-purple-600 text-white rounded-xl shadow-lg disabled:opacity-50"
          }, spinning ? "–ö—Ä—É—Ç–∏–º..." : "Spin üé∞")
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(SlotMachine));
  </script>
</body>
</html>
